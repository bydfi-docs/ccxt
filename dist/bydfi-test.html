<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script type="text/javascript" src="./ccxt.browser.js"></script>
    <script>
      // 添加延迟函数
      function delay() {
        return new Promise(resolve => setTimeout(resolve, 500));
      }

      async function update() {
        const updates = document.querySelector('#updates');
        
        const bydfi = new ccxt.bydfi();
        window.bydfi = bydfi;
        // const result = await bydfi.convertPositionSide('DELIVERY', 'W001', 'ONEWAY');
        // const result = await bydfi.createOrder('BTC/USDT:USDT', 'limit', 'buy', 133, 105000, {
        //   'wallet': 'W001',
        //   'quantity': 0.0001,
        //   'positionSide': 'LONG',
        //   'timeInForce': 'GTC',
        // });
        // const result = await bydfi.setLeverage(10, 'BTC/USDT:USDT', {
        //   'wallet': 'W001',
        // });
        // const result = await bydfi.setBatchLeverage(10, ['BTC/USDT:USDT', 'ETH/USDT:USDT'], 'W001');
        // const result = await bydfi.createOrder('BTC/USDT:USDT', 'limit', 'buy', 123, 105000, {
        //   'wallet': 'W001',
        //   'positionSide': 'BOTH',
        //   'timeInForce': 'GTC',
        // });
        const result = await bydfi.cancelOrder('1147854291534245888', 'BTC/USDT:USDT', {
          'wallet': 'W001',
        });
        console.log('result:', result);
        // 测试所有方法
        // try {
        //   // 1. 测试 fetchMarkets - 获取市场信息
        //   console.log('=== 测试 fetchMarkets ===');
        //   const markets = await bydfi.fetchMarkets();
        //   console.log('市场信息:', markets);
        //   addUpdate('✅ fetchMarkets 成功 - 获取到 ' + markets.length + ' 个市场');
          
        //   await delay(); // 延迟500ms
          
        //   // 2. 测试 fetchSwapTicker - 获取24小时价格统计
        //   console.log('=== 测试 fetchSwapTicker ===');
          
        //   // 2.1 测试获取单个币对的ticker
        //   console.log('--- 测试获取单个币对ticker ---');
        //   const ticker = await bydfi.fetchSwapTicker('BTC/USDT:USDT');
        //   console.log('BTC/USDT 24小时价格统计:', ticker);
        //   addUpdate('✅ fetchSwapTicker(BTC/USDT:USDT) 成功 - 最新价格: ' + ticker.last);
          
        //   await delay(); // 延迟500ms
          
        //   // // 2.2 测试获取所有币对的ticker数组
        //   // console.log('--- 测试获取所有币对ticker ---');
        //   // const allTickers = await bydfi.fetchSwapTicker();
        //   // console.log('所有币对24小时价格统计:', allTickers);
        //   // addUpdate('✅ fetchSwapTicker() 成功 - 获取到 ' + allTickers.length + ' 个币对的ticker数据');
          
        //   // // 显示前几个币对的价格信息
        //   // const firstFewTickers = allTickers.slice(0, 3);
        //   // firstFewTickers.forEach((t, index) => {
        //   //   addUpdate('   ' + (index + 1) + '. ' + t.symbol + ' - 最新价格: ' + t.last);
        //   // });
          
        //   // 3. 测试 fetchSwapFundingRate - 获取资金费率
        //   console.log('=== 测试 fetchFundingRate ===');
        //   const fundingRate = await bydfi.fetchFundingRate('BTC/USDT:USDT');
        //   console.log('BTC/USDT 资金费率:', fundingRate);
        //   addUpdate('✅ fetchFundingRate 成功 - 资金费率: ' + fundingRate.fundingRate);
          
        //   await delay(); // 延迟500ms
          
          // 4. 测试 fetchSwapFundingHistory - 获取资金历史
          // console.log('=== 测试 fetchSwapFundingHistory ===');
          // const fundingHistory = await bydfi.fetchSwapFundingHistory();
          // console.log('BTC/USDT 资金历史:', fundingHistory);
          // addUpdate('✅ fetchSwapFundingHistory 成功 - 获取到 ' + fundingHistory.length + ' 条记录');
          
        //   await delay(); // 延迟500ms
          
        //   // 5. 测试 fetchSwapMarketDepth - 获取市场深度
        //   console.log('=== 测试 fetchSwapMarketDepth ===');
        //   const marketDepth = await bydfi.fetchSwapMarketDepth('BTC/USDT:USDT', 10);
        //   console.log('BTC/USDT 市场深度:', marketDepth);
        //   addUpdate('✅ fetchSwapMarketDepth 成功 - 买单: ' + marketDepth.bids.length + ' 条, 卖单: ' + marketDepth.asks.length + ' 条');
          
        //   await delay(); // 延迟500ms
          
        //   // 6. 测试 fetchTrades - 获取交易记录
        //   console.log('=== 测试 fetchTrades ===');
        //   const trades = await bydfi.fetchTrades('BTC/USDT:USDT', undefined, 10);
        //   console.log('BTC/USDT 交易记录:', trades);
        //   addUpdate('✅ fetchTrades 成功 - 获取到 ' + trades.length + ' 条交易记录');
          
        //   await delay(); // 延迟500ms
          
        //   // 7. 测试 fetchOHLCV - 获取K线数据
        //   console.log('=== 测试 fetchOHLCV ===');
        //   const ohlcv = await bydfi.fetchOHLCV('BTC/USDT:USDT', '1m', 1750239564323, 10, {
        //     'endTime': 1750325967923
        //   });
        //   console.log('BTC/USDT K线数据:', ohlcv);
        //   addUpdate('✅ fetchOHLCV 成功 - 获取到 ' + ohlcv.length + ' 条K线数据');
          
        //   await delay(); // 延迟500ms
          
        //   // 8. 测试 fetchSwapLastPrice - 获取最新价格
        //   console.log('=== 测试 fetchSwapLastPrice ===');
        //   const lastPrices = await bydfi.fetchSwapLastPrice('BTC/USDT:USDT');
        //   console.log('BTC/USDT 最新价格:', lastPrices);
        //   addUpdate('✅ fetchSwapLastPrice 成功 - 最新价格: ' + lastPrices[0].price);
          
        //   await delay(); // 延迟500ms
          
        //   // 9. 测试 fetchMarkPrice - 获取标记价格
        //   console.log('=== 测试 fetchMarkPrice ===');
        //   const markPrice = await bydfi.fetchMarkPrice('BTC/USDT:USDT');
        //   console.log('BTC/USDT 标记价格:', markPrice);
        //   addUpdate('✅ fetchMarkPrice 成功 - 标记价格: ' + markPrice.markPrice);
          
        //   addUpdate('🎉 所有方法测试完成！');
          
        // } catch (error) {
        //   console.error('测试出错:', error);
        //   addUpdate('❌ 测试失败: ' + error.message);
        // }
      }
      
      function addUpdate(message) {
        const updates = document.querySelector('#updates');
        const li = document.createElement('li');
        li.textContent = message;
        updates.appendChild(li);
      }
    </script>
  </head>

  <body onload="update()">
    <h3>Bydfi API 方法测试</h3>
    <p>正在测试 bydfi.ts 中实现的所有方法...</p>
    <ul id="updates" style="color: black; font-family: monospace; font-size: 14px;"></ul>
  </body>
</html>
